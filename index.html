<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<title>HTML5 Video Player</title>

		<script src="jquery-1.5.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="jquery.media.js" type="text/javascript" charset="utf-8"></script>
		<script src="jquery.media.websrt.js" type="text/javascript" charset="utf-8"></script>
		<script src="jquery.media.tracks.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			var video;
			var tracks;
			
			$(document).ready(function () {

				//Set video
				video = $.media('video')

				//Add tracks plugin with config
				video.addPlugin('tracks', {
					subtitles: {
						target: $('#subtitles')
					},
					chapters: {
						start: function (chapter) {
							$('#current_chapter').append('<p id="chapter_' + chapter.num + '">' + chapter.content + '</p>');
						},
						end: function (chapter) {
							$('#chapter_' + chapter.num).remove();
						}
					}
				});

				tracks = video.plugins.tracks;

				//Swich between films
				$('button.films').click(function () {
					video.sources($(this).val());
					console.log(video.totalTime());
					video.totalTime(function (total) {
						console.log(total);
					});
				});


				//Load and unload the subtitles
				$('#change_subtitles input:checkbox').change(function () {
					if ($(this).is(':checked')) {
						tracks.load('#' + $(this).val());
					} else {
						tracks.unload('#' + $(this).val());
					}
				});


				//Set the settings for specific subtitle
				tracks.settingsFor('#sub-en', {
					target: '#subtitulos-ingles'
				});

				//Load a chapter and execute a function with data
				tracks.load('#chap-gl', function (chapters) {
					var $chapters = $('#chapters');

					$.each(chapters, function (index, chapter) {
						$chapters.append('<p data-id-chapter="' + chapter.id + '">' + chapter.content + '</p>');
					});
				});


				//Navigation chapters:

				//Go to specific chapter (using a string with the id)
				$('#chapters').delegate('p', 'click', function () {
					var id_chapter = $(this).data('id-chapter');

					tracks.seekTo('#chap-gl', id_chapter);
				});
				
				//Go to start of the previous chapter (zero)
				$('#curr-chapter').click(function () {
					tracks.seekTo('#chap-gl', 0);
				});
				
				//Go to previous chapter (negative number)
				$('#prev-chapter').click(function () {
					tracks.seekTo('#chap-gl', -1);
				});
				
				//Go to next chapter (positive number)
				$('#next-chapter').click(function () {
					tracks.seekTo('#chap-gl', 1);
				});
				
				video.playing(function (event, ms) {
					$('#time').html(this.milisecondsTo(ms, 'hh:mm:ss') + ' / ' + this.milisecondsTo(this.totalTime(), 'hh:mm:ss'));
				});
				
				/*
				video.bind('loadstart', function () {
					console.log('Browser starts loading data');
				});
				
				video.bind('progress', function () {
					console.log('Browser loads data');
				});
				
				video.bind('suspend', function () {
					console.log('Browser does not load data, waiting');
				});
				
				video.bind('abort', function () {
					console.log('Data loading was aborted');
				});
				
				video.bind('error', function () {
					console.log('An error ocurred');
				});
				
				video.bind('emptied', function () {
					console.log('Data not present unexpectedly');
				});
				
				video.bind('stalled', function () {
					console.log('Data transfer stalled');
				});
				
				video.bind('play', function () {
					console.log('Video started playing');
				});
				
				video.bind('pause', function () {
					console.log('Video has paused');
				});
				
				video.bind('loadedmetadata', function () {
					console.log('Metadata loaded');
				});
				
				video.bind('loadeddata', function () {
					console.log('Data loaded');
				});
				
				video.bind('waiting', function () {
					console.log('Waiting for more data');
				});
				
				video.bind('playing', function () {
					console.log('Blayback started');
				});
				
				video.bind('canplay', function () {
					console.log('Video can be played, but possibly must stop to buffer content');
				});
				
				video.bind('canplaythrough', function () {
					console.log('Enough data to play the whole video');
				});
				
				video.bind('seeking', function () {
					console.log('Seeking is true');
				});
				
				video.bind('seeked', function () {
					console.log('Seeking is now false');
				});
				
				video.bind('timeupdate', function () {
					console.log('currentTime was changed');
				});
				
				video.bind('ended', function () {
					console.log('Video has ended');
				});
				
				video.bind('ratechange', function () {
					console.log('Playback rate has changed');
				});
				
				video.bind('durationchange', function () {
					console.log('Duration has changed (for streams)');
				});

				video.bind('volumechange', function () {
					console.log('Volume has changed');
				});
				*/
				video.seek(function () {
					this.ready(4, function () {
						console.log('ola');
					});
				});
			});
		</script>
	</head>

	<body>
		<div style="float: left; width: 50%">
			<button class="films" value="http://people.opera.com/brucel/demo/video/leverage-a-synergy.ogv">Film with subtitles</button>
			<button class="films" value="http://fakenfb.anavallasuiza.com/ogg-not-chopped/chinchin.ogv">Film with chapters</button>
			
			<form id="change_subtitles">
				<fieldset>
					<legend>Choose subtitles:</legend>
					<label><input type="checkbox" value="sub-en"> English</label><br>
					<label><input type="checkbox" value="sub-de"> Deusche</label><br>
					<label><input type="checkbox" value="sub-fr"> French</label><br>
					<label><input type="checkbox" value="sub-ja"> Japan</label><br>
					<label><input type="checkbox" value="sub-nl"> Dutch</label>
				</fieldset>
			</form>

			<div id="time"></div>
			<video width="500" controls>
				<track id="sub-de" kind="subtitles" src="de.srt" srclang="de" label="Deusche">
				<track id="sub-en" kind="subtitles" src="en.srt" srclang="en" label="English">
				<track id="sub-fr" kind="subtitles" src="fr.srt" srclang="fr" label="FranÃ§ais">
				<track id="sub-ja" kind="subtitles" src="ja.srt" srclang="ja" label="Japan">
				<track id="sub-nl" kind="subtitles" src="nl.srt" srclang="nl" label="Dutch">

				<track id="chap-gl" kind="chapters" src="concerto.srt" srclang="gl" label="Track info">
			</video>
			<div id="subtitles"></div>
			<strong id="subtitulos-ingles"></strong>
		</div>
		<div style="overflow: hidden;">
			<div id="navigation"><button id="prev-chapter">Previous chapter</button> <button id="curr-chapter">Current chapter</button> <button id="next-chapter">Next chapter</button></div>
			<h1 id="current_chapter"></h1>
			<div id="chapters"></div>
		</div>
	</body>
</html>